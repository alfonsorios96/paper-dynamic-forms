<link rel="import" href="../../polymer/polymer-element.html">
<link rel="import" href="../../polymer/lib/elements/dom-if.html">
<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">

<link rel="import" href="../paper-dynamic-forms.html">

<dom-module id="demo-element">
    <template>
        <style is="custom-style" include="demo-pages-shared-styles">
        </style>

        <style>
            paper-button.fancy {
                background-color: var(--paper-green-500);
                color: white;
            }
        </style>

        <iron-ajax
                auto
                url="data.json"
                handle-as="json"
                on-response="handleResponse"
                debounce-duration="300"></iron-ajax>

        <div class="vertical-section-container centered">
            <h3>Basic demo for paper-dynamic-forms</h3>
            <paper-dynamic-forms type="option-input"
                                 sentences="[[response.inputOption]]"
                                 on-option-input-response="handler"></paper-dynamic-forms>
            <paper-dynamic-forms type="text-input" sentences="[[response.inputText]]"
                                 on-text-input-response="handler"></paper-dynamic-forms>
            <template is="dom-if" if="[[hasOptions]]">
                <paper-dynamic-forms type="text-input"
                                     sentences="[[response.options]]"
                                     on-text-input-response="handler"></paper-dynamic-forms>
            </template>
            <paper-button class="fancy" on-tap="createField">Create form field</paper-button>
            <hr>
            <h2>Your awesome form</h2>
            <paper-dynamic-forms
                    type="[[type]]"
                    sentences="[[sentences]]"></paper-dynamic-forms>
        </div>
    </template>

    <script>
        'use strict';
        (function PaperDynamicFormsDefinition(customElements) {
            /**
             * `paper-dynamic-forms`
             * This component gives a easy and comfortable way to magives a easy and comfortable way to make dynamics prohectske dynamics projects. E.g. polls
             *
             * @customElement
             * @polymer
             * @demo demo/index.html
             */
            class DemoElement extends Polymer.Element {
                static get is() {
                    return 'demo-element';
                }

                static get properties() {
                    return {
                        response: Object,
                        type: {
                            type: String,
                            observer: 'changeType'
                        },
                        sentence: {
                            type: Object,
                            value: {
                                label: '',
                                options: []
                            }
                        },
                        optionA: String,
                        optionB: String,
                        optionC: String,
                        optionD: String,
                        sentences: {
                            type: Array,
                            value: []
                        },
                        hasOptions: {
                            type: Boolean,
                            value: false
                        }
                    }
                }

                handleResponse(event) {
                    this.set('response', event.detail.response);
                }

                createField() {
                    this.push('sentence.options', this.optionA);
                    this.push('sentence.options', this.optionB);
                    this.push('sentence.options', this.optionC);
                    this.push('sentence.options', this.optionD);
                    this.push('sentences', this.sentence);
                    this.set('sentence', {
                        label: '',
                        options: []
                    });
                }

                handler(payload) {
                    switch (payload.detail.model.sentence.label) {
                        case 'Select a form type':
                            this.set('type', payload.detail.option);
                            break;
                        case 'Input a label for your form field':
                            this.set('sentence.label', payload.detail.option);
                            break;
                        case 'First option':
                            this.set('optionA', payload.detail.option);
                            break;
                        case 'Second option':
                            this.set('optionB', payload.detail.option);
                            break;
                        case 'Third option':
                            this.set('optionC', payload.detail.option);
                            break;
                        case 'Fourth option':
                            this.set('optionD', payload.detail.option);
                            break;

                    }
                }

                changeType(newValue, oldValue) {
                    if (newValue === 'text-input') {
                        this.set('hasOptions', false);
                    } else {
                        this.set('hasOptions', true);
                    }
                }
            }

            customElements.define(DemoElement.is, DemoElement);
        })(window.customElements);
    </script>
</dom-module>